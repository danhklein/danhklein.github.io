<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bluetooth Test</title>

  </head>
  <body>
    <form>
      <input id="service" type="text" list="services" autofocus="" placeholder="Bluetooth Service">
      <input id="name" type="text" placeholder="Device Name">
      <input id="namePrefix" type="text" placeholder="Device Name Prefix">
      <button>Get Bluetooth Device Info</button>
    </form>


<datalist id="services">
  <option value="alert_notification">alert_notification</option>
  <option value="automation_io">automation_io</option>
  <option value="battery_service">battery_service</option>
  <option value="blood_pressure">blood_pressure</option>
  <option value="body_composition">body_composition</option>
  <option value="bond_management">bond_management</option>
  <option value="continuous_glucose_monitoring">continuous_glucose_monitoring</option>
  <option value="current_time">current_time</option>
  <option value="cycling_power">cycling_power</option>
  <option value="cycling_speed_and_cadence">cycling_speed_and_cadence</option>
  <option value="device_information">device_information</option>
  <option value="environmental_sensing">environmental_sensing</option>
  <option value="generic_access">generic_access</option>
  <option value="generic_attribute">generic_attribute</option>
  <option value="glucose">glucose</option>
  <option value="health_thermometer">health_thermometer</option>
  <option value="heart_rate">heart_rate</option>
  <option value="human_interface_device">human_interface_device (blacklisted)</option>
  <option value="immediate_alert">immediate_alert</option>
  <option value="indoor_positioning">indoor_positioning</option>
  <option value="internet_protocol_support">internet_protocol_support</option>
  <option value="link_loss">link_loss</option>
  <option value="location_and_navigation">location_and_navigation</option>
  <option value="next_dst_change">next_dst_change</option>
  <option value="phone_alert_status">phone_alert_status</option>
  <option value="pulse_oximeter">pulse_oximeter</option>
  <option value="reference_time_update">reference_time_update</option>
  <option value="running_speed_and_cadence">running_speed_and_cadence</option>
  <option value="scan_parameters">scan_parameters</option>
  <option value="tx_power">tx_power</option>
  <option value="user_data">user_data</option>
  <option value="weight_scale">weight_scale</option>
</datalist>


<script>
function onFormSubmit() {
  'use strict';

  let options = {filters: []};

  let filterService = document.getElementById('service').value;
  if (filterService.startsWith('0x')) {
    filterService = parseInt(filterService, 16);
  }
  if (filterService) {
    options.filters.push({services: [filterService]});
  }

  let filterName = document.getElementById('name').value;
  if (filterName) {
    options.filters.push({name: filterName});
  }

  let filterNamePrefix = document.getElementById('namePrefix').value;
  if (filterNamePrefix) {
    options.filters.push({namePrefix: filterNamePrefix});
  }

  log('Requesting Bluetooth Device...');
  navigator.bluetooth.requestDevice(options)
  .then(device => {
    log('> Name:             ' + device.name);
    log('> Id:               ' + device.id);
    log('> UUIDs:            ' + device.uuids.join('\n' + ' '.repeat(20)));
    log('> Connected:        ' + device.gatt.connected);
    if (device.adData) {
      log('> Tx Power:         ' + device.adData.txPower + ' dBm');
      log('> RSSI:             ' + device.adData.rssi + ' dBm');
    }
  })
  .catch(error => {
    log('Argh! ' + error);
  });
}

  log = ChromeSamples.log;

  function isWebBluetoothEnabled() {
    if (navigator.bluetooth) {
      return true;
    } else {
      ChromeSamples.setStatus('Web Bluetooth API is not available.\n' +
                              'Please make sure the Web Bluetooth flag is enabled.');
      return false;
    }



  var ChromeSamples = {
    log: function() {
      var line = Array.prototype.slice.call(arguments).map(function(argument) {
        return typeof argument === 'string' ? argument : JSON.stringify(argument);
      }).join(' ');

      document.querySelector('#log').textContent += line + '\n';
    },

    clearLog: function() {
      document.querySelector('#log').textContent = '';
    },

    setStatus: function(status) {
      document.querySelector('#status').textContent = status;
    },

    setContent: function(newContent) {
      var content = document.querySelector('#content');
      while(content.hasChildNodes()) {
        content.removeChild(content.lastChild);
      }
      content.appendChild(newContent);
    }
  }
</script>

<h3>Live Output</h3>
<div id="output" class="output">
  <div id="content"></div>
  <div id="status"></div>
  <pre id="log"></pre>
</div>



    <script type="text/javascript" src="js/main.js"></script>
  </body>
</html>
